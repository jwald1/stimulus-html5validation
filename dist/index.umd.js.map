{"version":3,"file":"index.umd.js","sources":["../src/error.js","../src/validator.js","../src/index.js"],"sourcesContent":["const defaultMessages = {\n  badInput: \"is invalid\",\n  patternMismatch: \"doesn't match %{pattern}\",\n  rangeOverflow: \"must be less than %{max}\",\n  rangeUnderflow: \"must be greater than %{min}\",\n  stepMismatch: \"number is not divisible by %{step}\",\n  tooLong: \"is too long (maximum is %{maxLength} characters)\",\n  tooShort: \"is too short (minimum is %{minLength} characters)\",\n  typeMismatch: \"is not a valid %{type}\",\n  valueMissing: \"can't be blank\",\n}\n\nconst customMessageAttribute = {\n  badInput: \"is invalid\",\n  patternMismatch: \"patternValidationMessage\",\n  rangeOverflow: \"maxValidationMessage\",\n  rangeUnderflow: \"minValidationMessage\",\n  stepMismatch: \"stepValidationMessage\",\n  tooLong: \"maxlengthValidationMessage\",\n  tooShort: \"minlengthValidationMessage\",\n  typeMismatch: \"typeValidationMessage\",\n  valueMissing: \"requiredValidationMessage\",\n}\n\nexport default class {\n  constructor(el) {\n    this.el = el\n    this.errorType = this.errorType()\n  }\n\n  message() {\n    if (this.el.validity.valid) {\n      return\n    }\n\n    return this.customMessage() || this.defaultMessage()\n  }\n\n  // private\n\n  customMessage() {\n    const dataAttribute = customMessageAttribute[this.errorType]\n\n    return this.el.dataset[dataAttribute]\n  }\n\n  errorType() {\n    const errorTypes = Object.keys(defaultMessages)\n    for (let index = 0; index < errorTypes.length; index++) {\n      if (this.el.validity[errorTypes[index]]) {\n        return errorTypes[index]\n      }\n    }\n  }\n\n  defaultMessage() {\n    const message = defaultMessages[this.errorType]\n\n    return message.replace(/\\%\\{(.*)}/, (_, match) => {\n      return this.el[match]\n    })\n  }\n}\n","import ErrorMessage from \"./error\"\nconst debounce = require(\"lodash.debounce\")\n\nexport default class {\n  constructor(form, callback, debounceMs = 150) {\n    this.form = form\n    this.callback = callback\n    this.debounceMs = debounceMs\n\n    this.allFields().forEach(this.registerField)\n  }\n\n  destroy() {\n    this.allFields().forEach(this.deregisterField)\n  }\n\n  registerField = el => {\n    this.registerDergisterField(el, true)\n  }\n\n  deregisterField = el => {\n    this.registerDergisterField(el, false)\n  }\n\n  // private\n\n  registerDergisterField(el, bool) {\n    const action = bool ? \"addEventListener\" : \"removeEventListener\"\n\n    if (el.dataset.noValidate) {\n      return\n    }\n\n    if (el.nodeName === \"INPUT\") {\n      el[action](\"blur\", this.validateOnBlur)\n    }\n\n    el[action](\"input\", debounce(this.validate, this.debounceMs))\n    el[action](\"invalid\", this.validate)\n  }\n\n  validateOnBlur = e => {\n    e.target.dataset.visited = true\n\n    this.validate(e)\n  }\n\n  validate = e => {\n    e.preventDefault()\n\n    this.callback(e, {\n      error: this.errorMessage(e.target),\n      shouldDisplay: this.shouldValidate(e),\n    })\n  }\n\n  errorMessage(el) {\n    return new ErrorMessage(el).message()\n  }\n\n  shouldValidate(e) {\n    const { target } = e\n\n    if (\n      target.nodeName === \"INPUT\" &&\n      target.dataset.visited !== \"true\" &&\n      e.type !== \"invalid\" &&\n      !target.validity.valid\n    ) {\n      return false\n    }\n\n    return true\n  }\n\n  inputFields() {\n    return Array.from(this.form.querySelectorAll(\"input\")).filter(\n      el => el.type !== \"hidden\" && el.type !== \"submit\"\n    )\n  }\n\n  allFields() {\n    return Array.from(this.form.querySelectorAll(\"select, textarea\")).concat(\n      this.inputFields()\n    )\n  }\n}\n","import { Controller } from \"stimulus\"\nimport Validator from \"./validator\"\n\nexport default class extends Controller {\n  static targets = [\"submitButton\"]\n\n  connect() {\n    this.toggleDisableOnSubmitButton(true)\n    this.submitButtonTarget.addEventListener(\"click\", this.removeNoValidate)\n    this.validator = new Validator(\n      this.form,\n      this.validationCallback,\n      this.data.get(\"debounce\")\n    )\n  }\n\n  disconnect() {\n    this.submitButtonTarget.removeEventListener(\"click\", this.removeNoValidate)\n    this.validator.destroy()\n  }\n\n  get form() {\n    if (this.element.nodeName === \"FORM\") {\n      return this.element\n    } else {\n      return this.element.querySelector(\"form\")\n    }\n  }\n\n  isValid() {\n    this.data.set(\"noValidate\", true)\n    return this.form.checkValidity()\n  }\n\n  registerField = el => this.validator.registerField(el)\n  deregisterField = el => this.validator.deregisterField(el)\n\n  display(object) {\n    // overwrite\n  }\n\n  // private\n\n  removeNoValidate = () => {\n    this.data.delete(\"noValidate\")\n  }\n\n  focusFirstInput(e) {\n    if (this.data.get(\"focusOnError\") === \"false\" || e.type !== \"invalid\") {\n      return\n    }\n\n    const firstInputSelector = [\n      \"text\",\n      \"email\",\n      \"password\",\n      \"search\",\n      \"tel\",\n      \"url\",\n    ].map(type => `input[type=\"${type}\"]:invalid`)\n\n    this.form.querySelector(firstInputSelector.join(\",\")).focus()\n  }\n\n  toggleDisableOnSubmitButton(error) {\n    if (this.data.get(\"disableSubmit\") === \"false\") {\n      return\n    }\n\n    if (error) {\n      this.submitButtonTarget.disabled = true\n    } else if (this.isValid()) {\n      this.submitButtonTarget.disabled = false\n    }\n  }\n\n  validationCallback = (event, { error, shouldDisplay }) => {\n    if (event.type === \"invalid\" && this.data.has(\"noValidate\")) {\n      return\n    }\n\n    this.focusFirstInput(event)\n    this.toggleDisableOnSubmitButton(error)\n\n    if (shouldDisplay) {\n      this.display({ el: event.target, error })\n    }\n  }\n}\n"],"names":["defaultMessages","badInput","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","customMessageAttribute","el","errorType","validity","valid","customMessage","defaultMessage","dataAttribute","dataset","errorTypes","Object","keys","index","length","message","replace","_","match","debounce","require","form","callback","debounceMs","registerDergisterField","e","target","visited","validate","preventDefault","error","errorMessage","shouldDisplay","shouldValidate","allFields","forEach","registerField","deregisterField","bool","action","noValidate","nodeName","validateOnBlur","ErrorMessage","type","Array","from","querySelectorAll","filter","concat","inputFields","validator","data","delete","event","has","focusFirstInput","toggleDisableOnSubmitButton","display","submitButtonTarget","addEventListener","removeNoValidate","Validator","validationCallback","get","removeEventListener","destroy","set","checkValidity","object","firstInputSelector","map","querySelector","join","focus","disabled","isValid","element","Controller"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,MAAMA,eAAe,GAAG;EACtBC,EAAAA,QAAQ,EAAE,YADY;EAEtBC,EAAAA,eAAe,EAAE,0BAFK;EAGtBC,EAAAA,aAAa,EAAE,0BAHO;EAItBC,EAAAA,cAAc,EAAE,6BAJM;EAKtBC,EAAAA,YAAY,EAAE,oCALQ;EAMtBC,EAAAA,OAAO,EAAE,kDANa;EAOtBC,EAAAA,QAAQ,EAAE,mDAPY;EAQtBC,EAAAA,YAAY,EAAE,wBARQ;EAStBC,EAAAA,YAAY,EAAE;EATQ,CAAxB;EAYA,MAAMC,sBAAsB,GAAG;EAC7BT,EAAAA,QAAQ,EAAE,YADmB;EAE7BC,EAAAA,eAAe,EAAE,0BAFY;EAG7BC,EAAAA,aAAa,EAAE,sBAHc;EAI7BC,EAAAA,cAAc,EAAE,sBAJa;EAK7BC,EAAAA,YAAY,EAAE,uBALe;EAM7BC,EAAAA,OAAO,EAAE,4BANoB;EAO7BC,EAAAA,QAAQ,EAAE,4BAPmB;EAQ7BC,EAAAA,YAAY,EAAE,uBARe;EAS7BC,EAAAA,YAAY,EAAE;EATe,CAA/B;;;;;EAaE,oBAAYE,EAAZ,EAAgB;EAAA;;EACd,SAAKA,EAAL,GAAUA,EAAV;EACA,SAAKC,SAAL,GAAiB,KAAKA,SAAL,EAAjB;EACD;;;;gCAES;EACR,UAAI,KAAKD,EAAL,CAAQE,QAAR,CAAiBC,KAArB,EAA4B;EAC1B;EACD;;EAED,aAAO,KAAKC,aAAL,MAAwB,KAAKC,cAAL,EAA/B;EACD;;;;sCAIe;EACd,YAAMC,aAAa,GAAGP,sBAAsB,CAAC,KAAKE,SAAN,CAA5C;EAEA,aAAO,KAAKD,EAAL,CAAQO,OAAR,CAAgBD,aAAhB,CAAP;EACD;;;kCAEW;EACV,YAAME,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYrB,eAAZ,CAAnB;;EACA,WAAK,IAAIsB,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGH,UAAU,CAACI,MAAvC,EAA+CD,KAAK,EAApD,EAAwD;EACtD,YAAI,KAAKX,EAAL,CAAQE,QAAR,CAAiBM,UAAU,CAACG,KAAD,CAA3B,CAAJ,EAAyC;EACvC,iBAAOH,UAAU,CAACG,KAAD,CAAjB;EACD;EACF;EACF;;;uCAEgB;EACf,YAAME,OAAO,GAAGxB,eAAe,CAAC,KAAKY,SAAN,CAA/B;EAEA,aAAOY,OAAO,CAACC,OAAR,CAAgB,WAAhB,EAA6B,CAACC,CAAD,EAAIC,KAAJ,KAAc;EAChD,eAAO,KAAKhB,EAAL,CAAQgB,KAAR,CAAP;EACD,OAFM,CAAP;EAGD;;;;;;EC5DH,MAAMC,QAAQ,GAAGC,OAAO,CAAC,iBAAD,CAAxB;;;;;EAGE,sBAAYC,IAAZ,EAAkBC,QAAlB,EAA4BC,UAAU,GAAG,GAAzC,EAA8C;EAAA;;EAAA,2CAY9BrB,EAAE,IAAI;EACpB,WAAKsB,sBAAL,CAA4BtB,EAA5B,EAAgC,IAAhC;EACD,KAd6C;;EAAA,6CAgB5BA,EAAE,IAAI;EACtB,WAAKsB,sBAAL,CAA4BtB,EAA5B,EAAgC,KAAhC;EACD,KAlB6C;;EAAA,4CAqC7BuB,CAAC,IAAI;EACpBA,MAAAA,CAAC,CAACC,MAAF,CAASjB,OAAT,CAAiBkB,OAAjB,GAA2B,IAA3B;EAEA,WAAKC,QAAL,CAAcH,CAAd;EACD,KAzC6C;;EAAA,sCA2CnCA,CAAC,IAAI;EACdA,MAAAA,CAAC,CAACI,cAAF;EAEA,WAAKP,QAAL,CAAcG,CAAd,EAAiB;EACfK,QAAAA,KAAK,EAAE,KAAKC,YAAL,CAAkBN,CAAC,CAACC,MAApB,CADQ;EAEfM,QAAAA,aAAa,EAAE,KAAKC,cAAL,CAAoBR,CAApB;EAFA,OAAjB;EAID,KAlD6C;;EAC5C,SAAKJ,IAAL,GAAYA,IAAZ;EACA,SAAKC,QAAL,GAAgBA,QAAhB;EACA,SAAKC,UAAL,GAAkBA,UAAlB;EAEA,SAAKW,SAAL,GAAiBC,OAAjB,CAAyB,KAAKC,aAA9B;EACD;;;;gCAES;EACR,WAAKF,SAAL,GAAiBC,OAAjB,CAAyB,KAAKE,eAA9B;EACD;;;EAUD;6CAEuBnC,IAAIoC,MAAM;EAC/B,YAAMC,MAAM,GAAGD,IAAI,GAAG,kBAAH,GAAwB,qBAA3C;;EAEA,UAAIpC,EAAE,CAACO,OAAH,CAAW+B,UAAf,EAA2B;EACzB;EACD;;EAED,UAAItC,EAAE,CAACuC,QAAH,KAAgB,OAApB,EAA6B;EAC3BvC,QAAAA,EAAE,CAACqC,MAAD,CAAF,CAAW,MAAX,EAAmB,KAAKG,cAAxB;EACD;;EAEDxC,MAAAA,EAAE,CAACqC,MAAD,CAAF,CAAW,OAAX,EAAoBpB,QAAQ,CAAC,KAAKS,QAAN,EAAgB,KAAKL,UAArB,CAA5B;EACArB,MAAAA,EAAE,CAACqC,MAAD,CAAF,CAAW,SAAX,EAAsB,KAAKX,QAA3B;EACD;;;mCAiBY1B,IAAI;EACf,aAAO,IAAIyC,QAAJ,CAAiBzC,EAAjB,EAAqBa,OAArB,EAAP;EACD;;;qCAEcU,GAAG;EAChB,YAAM;EAAEC,QAAAA;EAAF,UAAaD,CAAnB;;EAEA,UACEC,MAAM,CAACe,QAAP,KAAoB,OAApB,IACAf,MAAM,CAACjB,OAAP,CAAekB,OAAf,KAA2B,MAD3B,IAEAF,CAAC,CAACmB,IAAF,KAAW,SAFX,IAGA,CAAClB,MAAM,CAACtB,QAAP,CAAgBC,KAJnB,EAKE;EACA,eAAO,KAAP;EACD;;EAED,aAAO,IAAP;EACD;;;oCAEa;EACZ,aAAOwC,KAAK,CAACC,IAAN,CAAW,KAAKzB,IAAL,CAAU0B,gBAAV,CAA2B,OAA3B,CAAX,EAAgDC,MAAhD,CACL9C,EAAE,IAAIA,EAAE,CAAC0C,IAAH,KAAY,QAAZ,IAAwB1C,EAAE,CAAC0C,IAAH,KAAY,QADrC,CAAP;EAGD;;;kCAEW;EACV,aAAOC,KAAK,CAACC,IAAN,CAAW,KAAKzB,IAAL,CAAU0B,gBAAV,CAA2B,kBAA3B,CAAX,EAA2DE,MAA3D,CACL,KAAKC,WAAL,EADK,CAAP;EAGD;;;;;;;;;;;;;;;;;;sECnDehD,EAAE,IAAI,MAAKiD,SAAL,CAAef,aAAf,CAA6BlC,EAA7B;;wEACJA,EAAE,IAAI,MAAKiD,SAAL,CAAed,eAAf,CAA+BnC,EAA/B;;yEAQL,MAAM;EACvB,YAAKkD,IAAL,CAAUC,MAAV,CAAiB,YAAjB;EACD;;2EA+BoB,CAACC,KAAD,EAAQ;EAAExB,MAAAA,KAAF;EAASE,MAAAA;EAAT,KAAR,KAAqC;EACxD,UAAIsB,KAAK,CAACV,IAAN,KAAe,SAAf,IAA4B,MAAKQ,IAAL,CAAUG,GAAV,CAAc,YAAd,CAAhC,EAA6D;EAC3D;EACD;;EAED,YAAKC,eAAL,CAAqBF,KAArB;;EACA,YAAKG,2BAAL,CAAiC3B,KAAjC;;EAEA,UAAIE,aAAJ,EAAmB;EACjB,cAAK0B,OAAL,CAAa;EAAExD,UAAAA,EAAE,EAAEoD,KAAK,CAAC5B,MAAZ;EAAoBI,UAAAA;EAApB,SAAb;EACD;EACF;;;;;;;gCAjFS;EACR,WAAK2B,2BAAL,CAAiC,IAAjC;EACA,WAAKE,kBAAL,CAAwBC,gBAAxB,CAAyC,OAAzC,EAAkD,KAAKC,gBAAvD;EACA,WAAKV,SAAL,GAAiB,IAAIW,UAAJ,CACf,KAAKzC,IADU,EAEf,KAAK0C,kBAFU,EAGf,KAAKX,IAAL,CAAUY,GAAV,CAAc,UAAd,CAHe,CAAjB;EAKD;;;mCAEY;EACX,WAAKL,kBAAL,CAAwBM,mBAAxB,CAA4C,OAA5C,EAAqD,KAAKJ,gBAA1D;EACA,WAAKV,SAAL,CAAee,OAAf;EACD;;;gCAUS;EACR,WAAKd,IAAL,CAAUe,GAAV,CAAc,YAAd,EAA4B,IAA5B;EACA,aAAO,KAAK9C,IAAL,CAAU+C,aAAV,EAAP;EACD;;;8BAKOC,QAAQ;EAIhB;;;;sCAMgB5C,GAAG;EACjB,UAAI,KAAK2B,IAAL,CAAUY,GAAV,CAAc,cAAd,MAAkC,OAAlC,IAA6CvC,CAAC,CAACmB,IAAF,KAAW,SAA5D,EAAuE;EACrE;EACD;;EAED,YAAM0B,kBAAkB,GAAG,CACzB,MADyB,EAEzB,OAFyB,EAGzB,UAHyB,EAIzB,QAJyB,EAKzB,KALyB,EAMzB,KANyB,EAOzBC,GAPyB,CAOrB3B,IAAI,IAAK,eAAcA,IAAK,YAPP,CAA3B;EASA,WAAKvB,IAAL,CAAUmD,aAAV,CAAwBF,kBAAkB,CAACG,IAAnB,CAAwB,GAAxB,CAAxB,EAAsDC,KAAtD;EACD;;;kDAE2B5C,OAAO;EACjC,UAAI,KAAKsB,IAAL,CAAUY,GAAV,CAAc,eAAd,MAAmC,OAAvC,EAAgD;EAC9C;EACD;;EAED,UAAIlC,KAAJ,EAAW;EACT,aAAK6B,kBAAL,CAAwBgB,QAAxB,GAAmC,IAAnC;EACD,OAFD,MAEO,IAAI,KAAKC,OAAL,EAAJ,EAAoB;EACzB,aAAKjB,kBAAL,CAAwBgB,QAAxB,GAAmC,KAAnC;EACD;EACF;;;uBArDU;EACT,UAAI,KAAKE,OAAL,CAAapC,QAAb,KAA0B,MAA9B,EAAsC;EACpC,eAAO,KAAKoC,OAAZ;EACD,OAFD,MAEO;EACL,eAAO,KAAKA,OAAL,CAAaL,aAAb,CAA2B,MAA3B,CAAP;EACD;EACF;;;;IAxB0BM;;yCACV,CAAC,cAAD;;;;;;;;"}